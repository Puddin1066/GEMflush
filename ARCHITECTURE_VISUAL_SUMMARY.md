# GEMflush KGaaS: Architecture Visual Summary

**Date:** November 10, 2025  
**Purpose:** Quick visual reference for how everything fits together

---

## ğŸ—ï¸ System Architecture (Current State)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER'S BROWSER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FRONTEND (Next.js 15 App Router)                                  â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Server Components (SSR):                                          â”‚  â”‚
â”‚  â”‚  â€¢ app/(dashboard)/dashboard/page.tsx â”€â”€â”€â”                         â”‚  â”‚
â”‚  â”‚  â€¢ app/(dashboard)/dashboard/businesses/[id]/page.tsx              â”‚  â”‚
â”‚  â”‚                                           â”‚                         â”‚  â”‚
â”‚  â”‚  Client Components (CSR):                 â”‚ Direct DB queries       â”‚  â”‚
â”‚  â”‚  â€¢ Interactive forms                      â”‚ (Server Components)     â”‚  â”‚
â”‚  â”‚  â€¢ Buttons with onClick handlers          â”‚                         â”‚  â”‚
â”‚  â”‚  â€¢ Real-time status polling               â–¼                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚ fetch('/api/...')                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERCEL SERVERLESS FUNCTIONS                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API ROUTES (app/api/)                                             â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  POST /api/business        â”€â”€â–º Create/Update business              â”‚  â”‚
â”‚  â”‚  POST /api/crawl           â”€â”€â–º Start web scraping job              â”‚  â”‚
â”‚  â”‚  POST /api/fingerprint     â”€â”€â–º Start LLM fingerprinting job        â”‚  â”‚
â”‚  â”‚  POST /api/wikidata/publish â”€â”€â–º Publish entity to Wikidata         â”‚  â”‚
â”‚  â”‚  GET  /api/job/[jobId]     â”€â”€â–º Poll job status                     â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Each route.ts = Standalone serverless function                    â”‚  â”‚
â”‚  â”‚  â€¢ Auto-deployed by Vercel                                         â”‚  â”‚
â”‚  â”‚  â€¢ Auto-scaled based on traffic                                    â”‚  â”‚
â”‚  â”‚  â€¢ 60s timeout (Pro tier)                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                  â”‚                  â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â”‚ Drizzle ORM      â”‚ lib/llm/         â”‚ lib/wikidata/
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUPABASE/      â”‚  â”‚   OPENROUTER     â”‚  â”‚  WIKIDATA API    â”‚
â”‚   NEON POSTGRES  â”‚  â”‚   (LLM Gateway)  â”‚  â”‚  (test/prod)     â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚
â”‚  Tables:         â”‚  â”‚  Models:         â”‚  â”‚  Endpoints:      â”‚
â”‚  â€¢ businesses    â”‚  â”‚  â€¢ GPT-4 Turbo   â”‚  â”‚  â€¢ /w/api.php    â”‚
â”‚  â€¢ crawlJobs     â”‚  â”‚  â€¢ Claude Haiku  â”‚  â”‚  â€¢ SPARQL query  â”‚
â”‚  â€¢ llmFingerprintsâ”‚  â”‚  â€¢ Gemini Pro    â”‚  â”‚                  â”‚
â”‚  â€¢ wikidataEntitiesâ”‚ â”‚                  â”‚  â”‚                  â”‚
â”‚  â€¢ teams         â”‚  â”‚  Cost:           â”‚  â”‚  Rate Limits:    â”‚
â”‚  â€¢ users         â”‚  â”‚  ~$0.005 per     â”‚  â”‚  60 req/min      â”‚
â”‚                  â”‚  â”‚  fingerprint     â”‚  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Examples

### Example 1: User Adds a Business

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚â”€â”€â”€â”€â–ºâ”‚ POST /api/   â”‚â”€â”€â”€â”€â–ºâ”‚ Validation  â”‚â”€â”€â”€â”€â–ºâ”‚ Database â”‚
â”‚         â”‚     â”‚ business     â”‚     â”‚ (Zod)       â”‚     â”‚ INSERT   â”‚
â”‚ Form    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Submit  â”‚            â”‚                     â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                     â”‚                  â”‚
     â–²                 â”‚                     â”‚                  â”‚
     â”‚                 â–¼                     â–¼                  â–¼
     â”‚          Auth Check             Business Logic      New Record
     â”‚          (getUser)              (getTeamForUser)    (id: 1)
     â”‚                 â”‚                     â”‚                  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Response: { success: true, businessId: 1 }
```

### Example 2: Crawl Website (Background Job)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚â”€â”€â”€â”€â–ºâ”‚ POST /api/   â”‚â”€â”€â”€â”€â–ºâ”‚ Create Job   â”‚â”€â”€â”€â”€â–ºâ”‚ Database â”‚
â”‚ Click    â”‚     â”‚ crawl        â”‚     â”‚ Record       â”‚     â”‚ INSERT   â”‚
â”‚ "Crawl"  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ status:      â”‚     â”‚ crawlJobsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚              â”‚ 'queued'     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
     â”‚                  â”‚                     â”‚                   â”‚
     â”‚      Immediate Response                â”‚                   â”‚
     â”‚      { jobId: 1, status: 'queued' }   â”‚                   â”‚
     â”‚                  â”‚                     â–¼                   â”‚
     â”‚                  â”‚              executeCrawlJob()          â”‚
     â”‚                  â”‚              (async background)         â”‚
     â”‚                  â”‚                     â”‚                   â”‚
     â”‚                  â”‚                     â–¼                   â”‚
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
     â”‚                  â”‚              â”‚ Web Crawler  â”‚           â”‚
     â”‚                  â”‚              â”‚ (Cheerio)    â”‚           â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
     â”‚                  â”‚                     â”‚                   â”‚
     â”‚                  â”‚                     â–¼                   â”‚
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
     â”‚                  â”‚              â”‚ Parse HTML   â”‚           â”‚
     â”‚                  â”‚              â”‚ Extract data â”‚           â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
     â”‚                  â”‚                     â”‚                   â”‚
     â”‚                  â”‚                     â–¼                   â”‚
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
     â”‚                  â”‚              â”‚ UPDATE       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚ crawlJobs    â”‚
     â”‚                  â”‚              â”‚ status:      â”‚
     â”‚                  â”‚              â”‚ 'completed'  â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Frontend polls GET /api/job/1
              every 2-5 seconds until complete
```

### Example 3: LLM Fingerprinting Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser  â”‚â”€â”€â”€â”€â–ºâ”‚ POST /api/   â”‚â”€â”€â”€â”€â–ºâ”‚ Create Job   â”‚â”€â”€â”€â”€â–ºâ”‚ Database â”‚
â”‚ Click    â”‚     â”‚ fingerprint  â”‚     â”‚ Record       â”‚     â”‚          â”‚
â”‚ "Run     â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Finger-  â”‚            â”‚                     â”‚
â”‚ print"   â”‚            â”‚                     â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚              executeFingerprintJob()
     â–²                  â”‚              (async background)
     â”‚                  â”‚                     â”‚
     â”‚      Response:   â”‚                     â–¼
     â”‚      { jobId: 2 }â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚              â”‚ Get Business â”‚
     â”‚                  â”‚              â”‚ Details      â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â–¼
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚              â”‚ Generate     â”‚
     â”‚                  â”‚              â”‚ Prompts      â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â–¼
     â”‚                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚       â”‚  Call OpenRouter API        â”‚
     â”‚                  â”‚       â”‚  â€¢ GPT-4: "What do you know â”‚
     â”‚                  â”‚       â”‚    about Joe's Coffee?"     â”‚
     â”‚                  â”‚       â”‚  â€¢ Claude: [same prompt]    â”‚
     â”‚                  â”‚       â”‚  â€¢ Gemini: [same prompt]    â”‚
     â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚
     â”‚                  â”‚              â–¼
     â”‚                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚       â”‚ Analyze      â”‚
     â”‚                  â”‚       â”‚ Responses    â”‚
     â”‚                  â”‚       â”‚ â€¢ Mentioned? â”‚
     â”‚                  â”‚       â”‚ â€¢ Accurate?  â”‚
     â”‚                  â”‚       â”‚ â€¢ Sentiment? â”‚
     â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚
     â”‚                  â”‚              â–¼
     â”‚                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚       â”‚ Calculate    â”‚
     â”‚                  â”‚       â”‚ Score (0-100)â”‚
     â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚
     â”‚                  â”‚              â–¼
     â”‚                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚       â”‚ INSERT       â”‚
     â”‚                  â”‚       â”‚ llmFingerprintâ”‚
     â”‚                  â”‚       â”‚ visibilityScoreâ”‚
     â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚
     â”‚                  â”‚              â–¼
     â”‚                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚       â”‚ UPDATE       â”‚
     â”‚                  â”‚       â”‚ crawlJobs    â”‚
     â”‚                  â”‚       â”‚ status:      â”‚
     â”‚                  â”‚       â”‚ 'completed'  â”‚
     â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Frontend polls /api/job/2
              Shows: "Score: 67/100"
```

---

## ğŸ—‚ï¸ File Structure & Responsibilities

```
saas-starter/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚       â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Dashboard overview (Server Component)
â”‚   â”‚       â”‚                        â€¢ Fetches stats directly from DB
â”‚   â”‚       â”‚                        â€¢ No API call needed (internal)
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ businesses/
â”‚   â”‚           â”œâ”€â”€ page.tsx â”€â”€â”€â”€â”€â”€â”€â–º Business list (Server Component)
â”‚   â”‚           â”‚                     â€¢ getBusinessesByTeam()
â”‚   â”‚           â”‚
â”‚   â”‚           â”œâ”€â”€ new/
â”‚   â”‚           â”‚   â””â”€â”€ page.tsx â”€â”€â”€â–º Add business form
â”‚   â”‚           â”‚                     â€¢ POST to /api/business
â”‚   â”‚           â”‚
â”‚   â”‚           â””â”€â”€ [id]/
â”‚   â”‚               â””â”€â”€ page.tsx â”€â”€â”€â–º Business detail (Server Component)
â”‚   â”‚                                 â€¢ getBusinessById()
â”‚   â”‚                                 â€¢ getLatestFingerprint()
â”‚   â”‚                                 â€¢ Shows action buttons
â”‚   â”‚
â”‚   â”œâ”€â”€ api/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º BACKEND API LAYER (Vercel Functions)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ business/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Create business
â”‚   â”‚   â”‚                           GET: List businesses
â”‚   â”‚   â”‚                           PUT: Update business
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ crawl/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Start crawl job
â”‚   â”‚   â”‚                           â€¢ Creates crawlJob record
â”‚   â”‚   â”‚                           â€¢ Executes webCrawler.crawl()
â”‚   â”‚   â”‚                           â€¢ Updates business.crawlData
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ fingerprint/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST: Start fingerprint job
â”‚   â”‚   â”‚                           â€¢ Creates crawlJob record
â”‚   â”‚   â”‚                           â€¢ Executes llmFingerprinter.fingerprint()
â”‚   â”‚   â”‚                           â€¢ Creates llmFingerprint record
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ wikidata/
â”‚   â”‚   â”‚   â””â”€â”€ publish/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts â”€â”€â”€â”€â”€â–º POST: Publish to Wikidata
â”‚   â”‚   â”‚                           â€¢ Check permissions (Pro only)
â”‚   â”‚   â”‚                           â€¢ Build entity with entity-builder
â”‚   â”‚   â”‚                           â€¢ Publish via publisher.publish()
â”‚   â”‚   â”‚                           â€¢ Store QID
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ job/
â”‚   â”‚       â””â”€â”€ [jobId]/
â”‚   â”‚           â””â”€â”€ route.ts â”€â”€â”€â”€â”€â–º GET: Job status
â”‚   â”‚                               â€¢ Returns current job state
â”‚   â”‚                               â€¢ Frontend polls this
â”‚   â”‚
â”‚   â””â”€â”€ globals.css â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Gem design system styles
â”‚
â”œâ”€â”€ lib/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SERVICE LAYER (Business Logic)
â”‚   â”‚
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schema.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Database tables (Drizzle ORM)
â”‚   â”‚   â”‚                           â€¢ 10 tables (users, teams, businesses, etc.)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ queries.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Database operations
â”‚   â”‚   â”‚                           â€¢ getBusinessById()
â”‚   â”‚   â”‚                           â€¢ createCrawlJob()
â”‚   â”‚   â”‚                           â€¢ getLatestFingerprint()
â”‚   â”‚   â”‚                           â€¢ ~30 functions
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ migrations/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SQL migration files
â”‚   â”‚
â”‚   â”œâ”€â”€ crawler/
â”‚   â”‚   â””â”€â”€ index.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Web scraper (Cheerio)
â”‚   â”‚                               â€¢ crawl(url) â†’ { data, success }
â”‚   â”‚                               â€¢ Extracts: name, address, phone, etc.
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ openrouter.ts â”€â”€â”€â”€â”€â”€â”€â”€â–º OpenRouter API client
â”‚   â”‚   â”‚                           â€¢ query(prompt, model)
â”‚   â”‚   â”‚                           â€¢ Handles: GPT-4, Claude, Gemini
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ fingerprinter.ts â”€â”€â”€â”€â”€â–º LLM fingerprinting logic
â”‚   â”‚                               â€¢ fingerprint(business)
â”‚   â”‚                               â€¢ Calls 3 models with prompts
â”‚   â”‚                               â€¢ Calculates visibility score
â”‚   â”‚
â”‚   â”œâ”€â”€ wikidata/
â”‚   â”‚   â”œâ”€â”€ entity-builder.ts â”€â”€â”€â”€â–º Wikidata entity generator
â”‚   â”‚   â”‚                           â€¢ buildEntity(business)
â”‚   â”‚   â”‚                           â€¢ Validates PIDs/QIDs
â”‚   â”‚   â”‚                           â€¢ Returns entity JSON
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ publisher.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Wikidata API client
â”‚   â”‚   â”‚                           â€¢ publish(entity, target)
â”‚   â”‚   â”‚                           â€¢ Returns QID
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ sparql.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SPARQL query builder
â”‚   â”‚
â”‚   â”œâ”€â”€ gemflush/
â”‚   â”‚   â”œâ”€â”€ permissions.ts â”€â”€â”€â”€â”€â”€â”€â–º Access control
â”‚   â”‚   â”‚                           â€¢ canUseWikidata(plan)
â”‚   â”‚   â”‚                           â€¢ canAddBusiness(plan, count)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ plans.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Plan definitions
â”‚   â”‚                               â€¢ Free: 1 business
â”‚   â”‚                               â€¢ Pro: 5 businesses + Wikidata
â”‚   â”‚                               â€¢ Agency: 25 businesses
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ session.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Authentication helpers
â”‚   â”‚                               â€¢ getUser()
â”‚   â”‚                               â€¢ setSession()
â”‚   â”‚                               â€¢ verifyToken()
â”‚   â”‚
â”‚   â””â”€â”€ validation/
â”‚       â””â”€â”€ business.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Zod schemas
â”‚                                   â€¢ businessSchema
â”‚                                   â€¢ urlSchema
â”‚                                   â€¢ locationSchema
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ui/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º UI components (shadcn/ui)
â”‚       â”œâ”€â”€ button.tsx
â”‚       â”œâ”€â”€ card.tsx
â”‚       â”œâ”€â”€ gem-icon.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Custom gem SVG icon
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ .env.local â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Environment variables
â”‚   DATABASE_URL=postgresql://...
â”‚   OPENROUTER_API_KEY=sk-or-...
â”‚   STRIPE_SECRET_KEY=sk_test_...
â”‚   AUTH_SECRET=...
â”‚
â””â”€â”€ package.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Dependencies
    â€¢ next: 15.4.0-canary.47
    â€¢ drizzle-orm: ^0.43.1
    â€¢ zod: ^3.24.4
    â€¢ cheerio: ^1.1.2
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. User Signs In                                             â”‚
â”‚     POST /api/sign-in                                         â”‚
â”‚     { email, password }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Verify Password      â”‚
          â”‚ (bcrypt compare)     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Generate JWT         â”‚
          â”‚ (jose library)       â”‚
          â”‚ Payload: { userId,   â”‚
          â”‚  teamId, email }     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Set Cookie           â”‚
          â”‚ Name: 'session'      â”‚
          â”‚ HttpOnly: true       â”‚
          â”‚ Secure: true         â”‚
          â”‚ SameSite: 'lax'      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Subsequent Requests                                       â”‚
â”‚     Cookie automatically sent with every request              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ API Route Handler    â”‚
          â”‚ const user = await   â”‚
          â”‚   getUser();         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ getUser() reads      â”‚
          â”‚ cookie, verifies JWT,â”‚
          â”‚ returns user payload â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ if (!user)           â”‚
          â”‚   return 401         â”‚
          â”‚ else                 â”‚
          â”‚   continue...        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’³ Payment Flow (Stripe Integration)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "Upgrade to Pro"                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ POST /api/stripe/  â”‚
        â”‚ checkout           â”‚
        â”‚ { planId: 'pro' }  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Create Stripe      â”‚
        â”‚ Checkout Session   â”‚
        â”‚ â€¢ Price: $49/month â”‚
        â”‚ â€¢ Customer: teamId â”‚
        â”‚ â€¢ Success URL      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Redirect to Stripe â”‚
        â”‚ Hosted Checkout    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Enters Card   â”‚
        â”‚ (Stripe handles    â”‚
        â”‚  all PCI stuff)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Payment Successful â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stripe Webhook fires                                          â”‚
â”‚ POST /api/stripe/webhook                                      â”‚
â”‚ Event: checkout.session.completed                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Verify Webhook     â”‚
        â”‚ Signature          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ UPDATE teams       â”‚
        â”‚ SET plan_name='pro'â”‚
        â”‚ WHERE id=teamId    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Redirect User Back â”‚
        â”‚ to Dashboard       â”‚
        â”‚ â€¢ Now has Pro      â”‚
        â”‚ â€¢ Can publish to   â”‚
        â”‚   Wikidata         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Job Processing: Current vs Future

### Current (MVP) - Good Enough for < 60s Jobs âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API POST â”‚â”€â”€â”€â”€â–ºâ”‚ Create Job   â”‚â”€â”€â”€â”€â–ºâ”‚ Execute      â”‚
â”‚ /api/    â”‚     â”‚ Record       â”‚     â”‚ Immediately  â”‚
â”‚ crawl    â”‚     â”‚ (status:     â”‚     â”‚ (async)      â”‚
â”‚          â”‚     â”‚  'queued')   â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â–¼
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚              â”‚ Update Job   â”‚
     â”‚                  â”‚              â”‚ (status:     â”‚
     â”‚                  â”‚              â”‚  'processing'â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â–¼
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚              â”‚ Do Work      â”‚
     â”‚                  â”‚              â”‚ (crawl,      â”‚
     â”‚                  â”‚              â”‚  fingerprint)â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â–¼
     â”‚                  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”‚              â”‚ Update Job   â”‚
     â”‚                  â”‚              â”‚ (status:     â”‚
     â”‚                  â”‚              â”‚  'completed')â”‚
     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚
     â”‚    Response:     â”‚
     â”‚    { jobId: 1 }  â”‚
     â”‚ (immediately)    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Frontend polls GET /api/job/1 every 2-5 seconds
```

**Limitations:**
- âš ï¸ Max 60s timeout (Vercel Pro)
- âš ï¸ No retries if fails
- âš ï¸ No priority queue
- âš ï¸ Blocks serverless function for duration

**Good For:**
- âœ… Web crawling (< 10s typically)
- âœ… LLM fingerprinting (< 30s)
- âœ… MVP validation

---

### Future (Month 2) - Production Queue System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API POST â”‚â”€â”€â”€â”€â–ºâ”‚ Create Job   â”‚â”€â”€â”€â”€â–ºâ”‚ Add to Redis â”‚
â”‚ /api/    â”‚     â”‚ Record       â”‚     â”‚ Queue        â”‚
â”‚ crawl    â”‚     â”‚ (status:     â”‚     â”‚ (BullMQ)     â”‚
â”‚          â”‚     â”‚  'queued')   â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                     â”‚
     â”‚                  â”‚                     â”‚
     â”‚    Response:     â”‚                     â”‚
     â”‚    { jobId: 1 }  â”‚                     â”‚
     â”‚ (immediately)    â”‚                     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                              â”‚
                                              â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Separate Worker    â”‚
                                   â”‚ (Vercel Cron or    â”‚
                                   â”‚  dedicated server) â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Poll Queue         â”‚
                                   â”‚ Get next job       â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Process Job        â”‚
                                   â”‚ â€¢ With retries     â”‚
                                   â”‚ â€¢ With priority    â”‚
                                   â”‚ â€¢ No timeout limit â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Update Job Status  â”‚
                                   â”‚ in Database        â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Frontend still polls GET /api/job/1
```

**Advantages:**
- âœ… No timeout limits
- âœ… Automatic retries
- âœ… Job prioritization
- âœ… Better error handling
- âœ… Scales independently

**Setup Required:**
```bash
# Add dependencies
pnpm add bullmq ioredis

# Configure Upstash Redis (free tier)
UPSTASH_REDIS_URL=...
UPSTASH_REDIS_TOKEN=...
```

---

## ğŸš€ Deployment Flow (Vercel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Local Development                                           â”‚
â”‚  â€¢ git commit                                                â”‚
â”‚  â€¢ git push origin main                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ GitHub Repository  â”‚
        â”‚ Webhook triggers   â”‚
        â”‚ Vercel build       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vercel Build Process                                        â”‚
â”‚  1. npm install (dependencies)                               â”‚
â”‚  2. next build (compile app)                                 â”‚
â”‚  3. Deploy functions (each route.ts)                         â”‚
â”‚  4. Deploy static assets (/_next/static/)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Vercel Edge Networkâ”‚
        â”‚ â€¢ Global CDN       â”‚
        â”‚ â€¢ Smart routing    â”‚
        â”‚ â€¢ Auto-scale       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Production URLs                                             â”‚
â”‚  â€¢ gemflush.vercel.app (default)                            â”‚
â”‚  â€¢ gemflush.com (custom domain)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Environment Variables (set in Vercel Dashboard):
  â€¢ DATABASE_URL
  â€¢ OPENROUTER_API_KEY
  â€¢ STRIPE_SECRET_KEY
  â€¢ AUTH_SECRET
```

---

## ğŸ’° Cost Breakdown (Monthly)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICE              â”‚  TIER      â”‚  COST               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vercel               â”‚  Pro       â”‚  $20/month          â”‚
â”‚  â€¢ 1TB bandwidth      â”‚            â”‚                     â”‚
â”‚  â€¢ 1,000 hrs function â”‚            â”‚                     â”‚
â”‚  â€¢ 60s timeout        â”‚            â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database (Neon)      â”‚  Hobby     â”‚  $0-10/month        â”‚
â”‚  â€¢ 3GB storage        â”‚            â”‚  (free tier OK)     â”‚
â”‚  â€¢ Scales as needed   â”‚            â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  OpenRouter           â”‚  Pay-as-go â”‚  ~$5/month          â”‚
â”‚  â€¢ GPT-4 Turbo        â”‚            â”‚  (100 fingerprints) â”‚
â”‚  â€¢ Claude Haiku       â”‚            â”‚  $0.005 each        â”‚
â”‚  â€¢ Gemini Pro         â”‚            â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Stripe               â”‚  2.9% + 30Â¢â”‚  Per transaction    â”‚
â”‚  â€¢ $49 Pro plan       â”‚            â”‚  ~$1.73 per sale    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Redis (Upstash)      â”‚  Free      â”‚  $0 (for now)       â”‚
â”‚  â€¢ 10K commands/day   â”‚            â”‚  (future: $10/mo)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  **TOTAL**            â”‚            â”‚  **$25-35/month**   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Break-even: 2 Pro subscriptions ($49 Ã— 2 = $98 revenue)
Target: 20 Pro users Ã— $49 = $980 MRR
Profit: $980 - $35 = $945/month ğŸ¯
```

---

## ğŸ“Š Performance Characteristics

### Response Times (Expected)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPERATION                    â”‚  TIME       â”‚  EXPERIENCE     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Page Load (Dashboard)        â”‚  < 500ms    â”‚  âš¡ Instant     â”‚
â”‚  â€¢ Server Component           â”‚             â”‚                 â”‚
â”‚  â€¢ Direct DB query            â”‚             â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Call (Create Business)   â”‚  < 200ms    â”‚  âš¡ Fast        â”‚
â”‚  â€¢ Validation + INSERT        â”‚             â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web Crawl Job                â”‚  2-10s      â”‚  â³ Background  â”‚
â”‚  â€¢ Fetch HTML                 â”‚             â”‚  â€¢ Poll status  â”‚
â”‚  â€¢ Parse with Cheerio         â”‚             â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  LLM Fingerprint Job          â”‚  5-30s      â”‚  â³ Background  â”‚
â”‚  â€¢ 3 LLM calls                â”‚             â”‚  â€¢ Poll status  â”‚
â”‚  â€¢ Analysis + scoring         â”‚             â”‚  â€¢ Show progressâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Wikidata Publish             â”‚  2-5s       â”‚  â³ Background  â”‚
â”‚  â€¢ Build entity               â”‚             â”‚  â€¢ Poll status  â”‚
â”‚  â€¢ API call to Wikidata       â”‚             â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Job Status Poll              â”‚  < 100ms    â”‚  âš¡ Real-time   â”‚
â”‚  â€¢ Simple SELECT query        â”‚             â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Queries (Optimization)

```sql
-- Fast Queries (< 10ms)
SELECT * FROM businesses WHERE id = 1;  -- Indexed primary key
SELECT * FROM teams WHERE id = 1;       -- Indexed primary key

-- Medium Queries (10-50ms)
SELECT * FROM businesses WHERE team_id = 1;  -- Indexed foreign key
SELECT * FROM llm_fingerprints WHERE business_id = 1 ORDER BY created_at DESC LIMIT 1;

-- Slow Queries (50-200ms) - Needs optimization later
SELECT * FROM businesses WHERE name ILIKE '%coffee%';  -- Full table scan
SELECT * FROM llm_fingerprints WHERE visibility_score > 80;  -- Full table scan
```

---

## ğŸ¯ Summary: You're 90% There!

### âœ… What You Have (Excellent)
1. Complete database schema
2. All API routes following best practices
3. Service layer with all logic
4. Frontend structure with gem design
5. Authentication working
6. Stripe integration ready

### ğŸ”¶ What You Need (The Final 10%)
1. Fix build error (30 min)
2. Connect UI buttons to APIs (1-2 days)
3. Add loading states (1 day)
4. Real API keys (1 hour)
5. Deploy to Vercel (2-3 hours)

### ğŸš€ Your Path to Launch
- **Week 1:** Fix â†’ Integrate â†’ Test
- **Week 2:** Polish â†’ Deploy â†’ Launch
- **Total Time:** 2 weeks to production! ğŸ‰

---

**Document Created:** November 10, 2025  
**Purpose:** Quick visual reference  
**Next Action:** Read START_HERE.md for immediate steps

**You've got this! Ship it! ğŸš€ğŸ’**

